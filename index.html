<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASMETO 2026 - Gestor de Futebol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .font-black-italic { font-weight: 900; font-style: italic; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="app" class="min-h-screen pb-12">
        <!-- O conteúdo será injetado pelo JavaScript -->
    </div>

    <script>
        // --- Estado Global com Persistência ---
        const STORAGE_KEY = 'asmeto_players_v3';

        function loadInitialState() {
            const savedPlayers = localStorage.getItem(STORAGE_KEY);
            return {
                view: 'setup',
                players: savedPlayers ? JSON.parse(savedPlayers) : [],
                confirmedIds: [], 
                newPlayerName: '',
                playersPerTeam: 5,
                teamA: [],
                teamB: [],
                waitingList: [],
                scoreA: 0,
                scoreB: 0,
                timer: 600,
                isActive: false,
                matchCount: 0,
                showEventModal: null, // 'A' ou 'B'
                eventType: null, // 'goal', 'yellow', 'red'
                selectedPlayerId: null,
                subModal: null
            };
        }

        let state = loadInitialState();
        let timerInterval = null;

        // --- Funções de Persistência ---
        function savePlayersToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state.players));
        }

        function clearStorage() {
            if (confirm("Apagar todos os atletas do banco de dados?")) {
                localStorage.removeItem(STORAGE_KEY);
                state.players = [];
                state.confirmedIds = [];
                render();
            }
        }

        // --- Lógica de Negócio ---

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <nav class="bg-white border-b border-gray-100 sticky top-0 z-40 px-6 py-5 shadow-sm">
                    <div class="max-w-md mx-auto flex justify-between items-center">
                        <div class="flex flex-col">
                            <h1 class="text-2xl font-black-italic tracking-tighter text-green-700 leading-none">ASMETO</h1>
                            <span class="text-[8px] font-black uppercase tracking-[0.4em] text-green-500/60 mt-1">TEMPORADA 2026</span>
                        </div>
                        <div class="bg-gray-100 p-1.5 rounded-2xl flex gap-1">
                            <button onclick="changeView('setup')" class="p-2.5 rounded-xl transition-all ${state.view === 'setup' ? 'bg-white shadow-sm text-green-700' : 'text-gray-400'}"><i data-lucide="settings"></i></button>
                            <button onclick="changeView('match')" class="p-2.5 rounded-xl transition-all ${state.view === 'match' ? 'bg-white shadow-sm text-green-700' : 'text-gray-400'}"><i data-lucide="timer"></i></button>
                            <button onclick="changeView('ranking')" class="p-2.5 rounded-xl transition-all ${state.view === 'ranking' ? 'bg-white shadow-sm text-green-700' : 'text-gray-400'}"><i data-lucide="trophy"></i></button>
                        </div>
                    </div>
                </nav>
                <main class="max-w-md mx-auto p-4 animate-fade-in">
                    ${state.view === 'setup' ? renderSetup() : state.view === 'match' ? renderMatch() : renderRanking()}
                </main>
                ${renderModals()}
            `;
            lucide.createIcons();
        }

        function changeView(view) {
            state.view = view;
            render();
        }

        function togglePresence(id) {
            if (state.confirmedIds.includes(id)) {
                state.confirmedIds = state.confirmedIds.filter(cid => cid !== id);
            } else {
                state.confirmedIds.push(id);
            }
            render();
        }

        function toggleAllPresence() {
            if (state.confirmedIds.length === state.players.length) {
                state.confirmedIds = [];
            } else {
                state.confirmedIds = state.players.map(p => p.id);
            }
            render();
        }

        function addPlayer() {
            const name = state.newPlayerName.trim();
            if (!name) return;
            const player = {
                id: Date.now(),
                name: name,
                goals: 0,
                assists: 0,
                yellowCards: 0,
                redCards: 0,
                wins: 0,
                matches: 0
            };
            state.players.push(player);
            state.confirmedIds.push(player.id);
            state.newPlayerName = '';
            savePlayersToStorage();
            render();
        }

        function removePlayer(id) {
            if (!confirm("Remover atleta permanentemente do banco?")) return;
            state.players = state.players.filter(p => p.id !== id);
            state.confirmedIds = state.confirmedIds.filter(cid => cid !== id);
            savePlayersToStorage();
            render();
        }

        function startMatch() {
            const activePlayers = state.players.filter(p => state.confirmedIds.includes(p.id));
            if (activePlayers.length < state.playersPerTeam * 2) {
                alert(`Confirme pelo menos ${state.playersPerTeam * 2} jogadores para iniciar.`);
                return;
            }
            const shuffled = [...activePlayers].sort(() => Math.random() - 0.5);
            state.teamA = shuffled.slice(0, state.playersPerTeam);
            state.teamB = shuffled.slice(state.playersPerTeam, state.playersPerTeam * 2);
            state.waitingList = shuffled.slice(state.playersPerTeam * 2);
            state.view = 'match';
            render();
        }

        function finishMatch(winner) {
            const winners = winner === 'A' ? state.teamA : state.teamB;
            const losers = winner === 'A' ? state.teamB : state.teamA;

            state.players.forEach(p => {
                if (winners.some(w => w.id === p.id)) { p.wins++; p.matches++; }
                else if (losers.some(l => l.id === p.id)) { p.matches++; }
            });

            state.matchCount++;
            let nextTeam = [];
            let remainingLosers = [...losers];

            if (state.waitingList.length >= state.playersPerTeam) {
                nextTeam = state.waitingList.slice(0, state.playersPerTeam);
                state.waitingList = state.waitingList.slice(state.playersPerTeam);
            } else {
                nextTeam = [...state.waitingList];
                const needed = state.playersPerTeam - nextTeam.length;
                const takenFromLosers = remainingLosers.slice(0, needed);
                remainingLosers = remainingLosers.slice(needed);
                nextTeam = [...nextTeam, ...takenFromLosers];
                state.waitingList = [];
            }

            state.waitingList = [...state.waitingList, ...remainingLosers];
            if (winner === 'A') state.teamB = nextTeam;
            else state.teamA = nextTeam;

            state.scoreA = 0; state.scoreB = 0;
            state.timer = 600;
            toggleTimer(false);
            savePlayersToStorage();
            render();
        }

        // --- Renderização ---

        function renderSetup() {
            return `
                <div class="space-y-6">
                    <div class="bg-gradient-to-br from-green-600 to-green-900 p-6 rounded-[32px] text-white shadow-xl flex justify-between items-start">
                        <div>
                            <h2 class="text-2xl font-black-italic tracking-tighter">LISTA DE PRESENÇA</h2>
                            <p class="text-green-100 text-[10px] font-bold opacity-80 uppercase tracking-widest mt-1">Marque quem compareceu</p>
                        </div>
                        <button onclick="clearStorage()" class="p-2.5 bg-white/10 hover:bg-white/20 rounded-xl transition-colors">
                            <i data-lucide="database-zap" size="20"></i>
                        </button>
                    </div>

                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100">
                        <div class="flex gap-2">
                            <input type="text" placeholder="Nome do novo atleta..." 
                                oninput="state.newPlayerName = this.value" value="${state.newPlayerName}"
                                class="flex-1 p-4 bg-gray-50 border border-gray-200 rounded-2xl outline-none font-medium focus:ring-2 focus:ring-green-500 transition-all">
                            <button onclick="addPlayer()" class="bg-green-600 text-white px-5 rounded-2xl shadow-lg shadow-green-200 active:scale-95 transition-transform"><i data-lucide="user-plus"></i></button>
                        </div>
                    </div>

                    <div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden">
                        <div class="p-5 border-b border-gray-50 flex justify-between items-center bg-gray-50/50">
                            <h3 class="font-black text-xs uppercase text-gray-400 tracking-tighter">Atletas Registrados (${state.players.length})</h3>
                            <button onclick="toggleAllPresence()" class="text-[10px] font-black uppercase text-green-600 px-3 py-1 bg-green-50 rounded-lg">
                                ${state.confirmedIds.length === state.players.length ? 'Desmarcar Todos' : 'Marcar Todos'}
                            </button>
                        </div>
                        <div class="max-h-80 overflow-y-auto custom-scrollbar p-2">
                            ${state.players.length === 0 ? '<p class="text-center text-gray-300 text-xs py-10 italic">Nenhum atleta cadastrado.</p>' : ''}
                            <div class="grid grid-cols-1 gap-1">
                                ${state.players.map(p => {
                                    const isConfirmed = state.confirmedIds.includes(p.id);
                                    return `
                                        <div class="flex items-center gap-3 p-3 rounded-2xl transition-all ${isConfirmed ? 'bg-green-50/50 border border-green-100' : 'bg-transparent border border-transparent'}">
                                            <button onclick="togglePresence(${p.id})" class="flex-1 flex items-center gap-3 text-left">
                                                <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${isConfirmed ? 'bg-green-600 border-green-600 text-white' : 'border-gray-200 bg-white'}">
                                                    ${isConfirmed ? '<i data-lucide="check" size="14"></i>' : ''}
                                                </div>
                                                <span class="font-bold uppercase italic text-sm ${isConfirmed ? 'text-green-900' : 'text-gray-500'}">${p.name}</span>
                                            </button>
                                            <button onclick="removePlayer(${p.id})" class="text-gray-300 hover:text-red-500 p-2"><i data-lucide="x" size="16"></i></button>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 text-center">
                        <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest block mb-2">Configuração da Partida</label>
                        <div class="flex items-center justify-center gap-4">
                            <button onclick="state.playersPerTeam=Math.max(2,state.playersPerTeam-1); render()" class="w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center font-bold">-</button>
                            <div class="text-center min-w-[60px]">
                                <span class="text-3xl font-black-italic text-green-700">${state.playersPerTeam}</span>
                                <p class="text-[8px] font-bold text-gray-400 uppercase">Por Time</p>
                            </div>
                            <button onclick="state.playersPerTeam=Math.min(11,state.playersPerTeam+1); render()" class="w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center font-bold">+</button>
                        </div>
                    </div>

                    <div class="sticky bottom-4 px-2">
                        <button onclick="startMatch()" class="w-full bg-zinc-900 text-white font-black py-5 rounded-2xl shadow-xl uppercase tracking-widest active:scale-95 transition-all flex items-center justify-center gap-3">
                            <i data-lucide="play-circle"></i>
                            Sorteio com ${state.confirmedIds.length} Atletas
                        </button>
                    </div>
                </div>
            `;
        }

        function renderMatch() {
            const formatTime = (s) => `${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;
            return `
                <div class="space-y-6">
                    <div class="bg-zinc-900 text-white p-8 rounded-[40px] shadow-2xl text-center border-b-8 border-green-600 relative overflow-hidden">
                        <div class="absolute top-4 left-4 text-[10px] font-black text-zinc-700 uppercase italic">Jogo #${state.matchCount + 1}</div>
                        <div class="flex justify-around items-center mb-6">
                            <div class="flex flex-col items-center gap-2">
                                <span class="text-[10px] font-black uppercase text-green-500">TIME A</span>
                                <span class="text-7xl font-black-italic">${state.scoreA}</span>
                                <div class="flex gap-1 mt-2">
                                    <button onclick="state.showEventModal='A'; state.eventType='goal'; render();" class="bg-green-600 p-2 rounded-lg text-white"><i data-lucide="plus-circle" size="20"></i></button>
                                    <button onclick="state.showEventModal='A'; state.eventType='yellow'; render();" class="bg-yellow-500 p-2 rounded-lg text-black"><i data-lucide="copy" size="20"></i></button>
                                    <button onclick="state.showEventModal='A'; state.eventType='red'; render();" class="bg-red-600 p-2 rounded-lg text-white"><i data-lucide="copy" size="20"></i></button>
                                </div>
                            </div>
                            <div class="flex flex-col items-center">
                                <div class="text-4xl font-mono font-black mb-2 text-green-400">${formatTime(state.timer)}</div>
                                <div class="flex gap-2">
                                    <button onclick="toggleTimer()" class="p-3 bg-zinc-800 rounded-2xl">${state.isActive ? '<i data-lucide="pause"></i>' : '<i data-lucide="play"></i>'}</button>
                                    <button onclick="state.timer=600; render();" class="p-3 bg-zinc-800 rounded-2xl"><i data-lucide="rotate-ccw"></i></button>
                                </div>
                            </div>
                            <div class="flex flex-col items-center gap-2">
                                <span class="text-[10px] font-black uppercase text-blue-500">TIME B</span>
                                <span class="text-7xl font-black-italic">${state.scoreB}</span>
                                <div class="flex gap-1 mt-2">
                                    <button onclick="state.showEventModal='B'; state.eventType='goal'; render();" class="bg-blue-600 p-2 rounded-lg text-white"><i data-lucide="plus-circle" size="20"></i></button>
                                    <button onclick="state.showEventModal='B'; state.eventType='yellow'; render();" class="bg-yellow-500 p-2 rounded-lg text-black"><i data-lucide="copy" size="20"></i></button>
                                    <button onclick="state.showEventModal='B'; state.eventType='red'; render();" class="bg-red-600 p-2 rounded-lg text-white"><i data-lucide="copy" size="20"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="finishMatch('A')" class="flex-1 bg-green-600/20 text-green-500 border border-green-600/40 py-3 rounded-2xl text-[10px] font-black uppercase">Vitória A</button>
                            <button onclick="finishMatch('B')" class="flex-1 bg-blue-600/20 text-blue-500 border border-blue-600/40 py-3 rounded-2xl text-[10px] font-black uppercase">Vitória B</button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${renderTeamCard('A', state.teamA)}
                        ${renderTeamCard('B', state.teamB)}
                    </div>

                    <div class="bg-amber-50 p-6 rounded-[32px] border border-amber-100 shadow-inner">
                        <h4 class="font-black text-amber-800 mb-4 text-[10px] uppercase tracking-widest flex items-center gap-2"><i data-lucide="list-ordered" size="14"></i> Próximos na Fila (${state.waitingList.length})</h4>
                        <div class="flex flex-wrap gap-2">
                            ${state.waitingList.map((p, idx) => `
                                <span class="px-4 py-2 bg-white rounded-2xl text-[10px] font-black italic uppercase border border-amber-200 text-amber-900 inline-flex items-center gap-2 shadow-sm">
                                    <span class="text-amber-400 font-mono">${idx+1}º</span> ${p.name}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTeamCard(label, team) {
            const color = label === 'A' ? 'text-green-600' : 'text-blue-600';
            const bgColor = label === 'A' ? 'bg-green-50/50' : 'bg-blue-50/50';
            return `
                <div class="bg-white p-5 rounded-3xl border border-gray-100 shadow-sm">
                    <h4 class="font-black text-gray-400 mb-4 text-[10px] uppercase flex justify-between">TIME ${label} <span class="${color}">${team.length} JOGS</span></h4>
                    <div class="space-y-2">
                        ${team.map(p => `
                            <div class="flex justify-between items-center p-3 ${bgColor} rounded-2xl">
                                <span class="font-black text-gray-800 italic uppercase text-xs">${p.name}</span>
                                <button onclick="openSubModal('${label}', ${p.id})" class="text-amber-600 p-2 bg-white rounded-xl shadow-sm"><i data-lucide="refresh-cw" size="14"></i></button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderRanking() {
            const sorted = [...state.players].sort((a,b) => {
                const aprA = a.matches > 0 ? (a.wins/a.matches) : 0;
                const aprB = b.matches > 0 ? (b.wins/b.matches) : 0;
                if(aprB !== aprA) return aprB - aprA;
                return b.goals - a.goals;
            });

            return `
                <div class="space-y-6 pb-20 overflow-x-hidden">
                    <div class="flex justify-between items-center bg-white p-4 rounded-2xl shadow-sm">
                        <h2 class="text-xl font-black-italic tracking-tighter flex items-center gap-2"><i data-lucide="trophy" class="text-yellow-500"></i> RELATÓRIO</h2>
                        <button onclick="exportCSV()" class="bg-zinc-900 text-white px-5 py-2.5 rounded-xl text-xs font-black uppercase flex items-center gap-2"><i data-lucide="download" size="16"></i> CSV</button>
                    </div>
                    <div class="bg-zinc-900 rounded-[32px] overflow-x-auto custom-scrollbar border border-zinc-800 shadow-2xl">
                        <table class="w-full text-left text-zinc-300 min-w-[500px]">
                            <thead class="bg-zinc-800 text-zinc-500 text-[8px] uppercase font-black tracking-widest">
                                <tr>
                                    <th class="px-5 py-4 text-center">#</th>
                                    <th class="px-5 py-4">ATLETA</th>
                                    <th class="px-5 py-4 text-center">GOLS</th>
                                    <th class="px-5 py-4 text-center">ASSIST</th>
                                    <th class="px-5 py-4 text-center text-yellow-500">AM</th>
                                    <th class="px-5 py-4 text-center text-red-500">VM</th>
                                    <th class="px-5 py-4 text-center">VIT</th>
                                    <th class="px-5 py-4 text-right">APR.</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-zinc-800">
                                ${sorted.map((p, i) => `
                                    <tr class="hover:bg-zinc-800/50">
                                        <td class="px-5 py-4 text-center font-black ${i===0?'text-yellow-500':i===1?'text-slate-400':'text-zinc-600'}">${i+1}</td>
                                        <td class="px-5 py-4 font-black uppercase italic text-xs truncate max-w-[120px]">${p.name}</td>
                                        <td class="px-5 py-4 text-center font-black text-green-500">${p.goals}</td>
                                        <td class="px-5 py-4 text-center font-black text-blue-500">${p.assists}</td>
                                        <td class="px-5 py-4 text-center font-black text-yellow-500">${p.yellowCards}</td>
                                        <td class="px-5 py-4 text-center font-black text-red-500">${p.redCards}</td>
                                        <td class="px-5 py-4 text-center font-black text-amber-500">${p.wins}</td>
                                        <td class="px-5 py-4 text-right font-black italic text-xs">${p.matches > 0 ? Math.round((p.wins/p.matches)*100) : 0}%</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderModals() {
            let html = '';
            if (state.showEventModal) {
                const team = state.showEventModal === 'A' ? state.teamA : state.teamB;
                const titles = { goal: 'QUEM MARCOU?', yellow: 'CARTÃO AMARELO', red: 'CARTÃO VERMELHO' };
                
                html += `
                    <div class="fixed inset-0 bg-black/90 backdrop-blur-md z-50 flex items-center justify-center p-4">
                        <div class="bg-white w-full max-w-sm rounded-[32px] overflow-hidden shadow-2xl animate-fade-in">
                            <div class="bg-zinc-900 p-6 text-white text-center font-black-italic uppercase tracking-widest">${titles[state.eventType]}</div>
                            <div class="p-6 space-y-3">
                                ${!state.selectedPlayerId ? 
                                    team.map(p => `<button onclick="handleEventSelection(${p.id})" class="w-full p-4 bg-gray-50 rounded-2xl font-black uppercase italic text-left flex justify-between group hover:bg-green-50 transition-colors">${p.name} <i data-lucide="user"></i></button>`).join('') :
                                    (state.eventType === 'goal' ? `
                                        <p class="text-[10px] font-black text-gray-400 uppercase text-center mb-2">Assistência de:</p>
                                        <button onclick="registerEvent(null)" class="w-full p-4 bg-gray-100 rounded-2xl font-black uppercase italic text-gray-500">Sem Assistência</button>
                                        ${team.filter(p => p.id !== state.selectedPlayerId).map(p => `
                                            <button onclick="registerEvent(${p.id})" class="w-full p-4 bg-blue-50 text-blue-900 rounded-2xl font-black uppercase italic flex justify-between border border-blue-100">${p.name} <i data-lucide="hand-helping"></i></button>
                                        `).join('')}
                                    ` : '')
                                }
                                <button onclick="resetEventState()" class="w-full text-gray-400 font-black py-2 uppercase text-[10px] tracking-widest mt-4">Cancelar</button>
                            </div>
                        </div>
                    </div>
                `;
            }

            if (state.subModal) {
                const { player, teamName } = state.subModal;
                html += `
                    <div class="fixed inset-0 bg-black/80 backdrop-blur-md z-50 flex items-center justify-center p-4">
                        <div class="bg-white w-full max-w-sm rounded-[32px] p-6 shadow-2xl animate-fade-in">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-lg font-black-italic uppercase tracking-tighter">Substituição</h3>
                                <button onclick="state.subModal=null; render();" class="p-2 bg-gray-100 rounded-full"><i data-lucide="x" size="18"></i></button>
                            </div>
                            <div class="mb-8 text-center bg-zinc-900 p-6 rounded-3xl">
                                <p class="text-[8px] font-black text-zinc-500 uppercase tracking-widest">Saindo</p>
                                <p class="text-2xl font-black-italic uppercase text-white">${player.name}</p>
                            </div>
                            <div class="space-y-3">
                                <button onclick="executeSub()" class="w-full bg-amber-500 text-white font-black py-4 rounded-2xl flex items-center justify-center gap-3 active:scale-95 transition-all shadow-lg">Puxar da Fila</button>
                            </div>
                        </div>
                    </div>
                `;
            }
            return html;
        }

        // --- Ações de Apoio ---

        function handleEventSelection(playerId) {
            state.selectedPlayerId = playerId;
            if (state.eventType !== 'goal') {
                registerEvent(null);
            } else {
                render();
            }
        }

        function resetEventState() {
            state.showEventModal = null;
            state.eventType = null;
            state.selectedPlayerId = null;
            render();
        }

        function toggleTimer(forced) {
            state.isActive = forced !== undefined ? forced : !state.isActive;
            if (state.isActive) {
                timerInterval = setInterval(() => {
                    if (state.timer > 0) {
                        state.timer--;
                        render();
                    } else {
                        toggleTimer(false);
                    }
                }, 1000);
            } else {
                clearInterval(timerInterval);
            }
            render();
        }

        function registerEvent(assistId) {
            const playerId = state.selectedPlayerId;
            const type = state.eventType;
            const team = state.showEventModal;

            state.players = state.players.map(p => {
                if (p.id === playerId) {
                    if (type === 'goal') {
                        p.goals++;
                        if (team === 'A') state.scoreA++; else state.scoreB++;
                    }
                    if (type === 'yellow') p.yellowCards++;
                    if (type === 'red') p.redCards++;
                }
                if (type === 'goal' && assistId && p.id === assistId) p.assists++;
                return p;
            });

            resetEventState();
            savePlayersToStorage();
        }

        function openSubModal(teamName, playerId) {
            const team = teamName === 'A' ? state.teamA : state.teamB;
            const player = team.find(p => p.id === playerId);
            state.subModal = { team, player, teamName };
            render();
        }

        function executeSub() {
            const { team, player, teamName } = state.subModal;
            if (state.waitingList.length === 0) return alert("Ninguém na fila de espera!");
            const next = state.waitingList.shift();
            state.waitingList.push(player);
            const newTeam = team.map(p => p.id === player.id ? next : p);
            if (teamName === 'A') state.teamA = newTeam; else state.teamB = newTeam;
            state.subModal = null;
            render();
        }

        function exportCSV() {
            const headers = ["Atleta", "Gols", "Assistencias", "Amarelos", "Vermelhos", "Vitorias", "Partidas", "Aproveitamento"];
            const rows = state.players.map(p => [
                p.name, p.goals, p.assists, p.yellowCards, p.redCards, p.wins, p.matches,
                p.matches > 0 ? `${Math.round((p.wins / p.matches) * 100)}%` : "0%"
            ]);
            const content = [headers, ...rows].map(e => e.join(",")).join("\n");
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `asmeto_estatisticas_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        render();
    </script>
</body>
</html>